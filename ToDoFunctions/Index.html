<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Index</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
</head>
<body style="background-color: gainsboro">
    <div class="container">
        <div class="jumbotron" style="background-color: white">
            <h2>To Do List Using Azure Functions</h2>
            <p>
                This web app uses a serverless technology called Azure Functions to serve up HTML pages to you.
                <br />
                <br />
                <a class="btn btn-primary btn-group-sm" href="https://azure.microsoft.com/en-us/services/functions/?&WT.srch=1&WT.mc_id=AID623261_SEM_uJOA6Xlm&gclid=Cj0KCQjwtJzLBRC7ARIsAGMkOAmPEWSay_1JzokjrEhH8dXkKSaGRoiro02_WCjxKNeN4Q35FLi-GPcaAn6GEALw_wcB" role="button">Learn more about Azure Functions</a>
            </p>
            <p></p>
        </div>
    </div>
    <div id="todolist" class="container"></div>
    <br />
    <div class="container">
        <input type="button" onclick="location.href='/AddToDoItem';" value="Add A New To Do Item" class="btn btn-lg btn-primary" />
        <br />
        <br />
        <input type="button" class="btn btn-sm btn-primary" onclick="location.href = '/ToDoHistory';" value="View To Do Item History" />
    </div>
</body>
</html>







<script src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous"></script>
<script>
    window.onload = function () {       
        $.get("/GetToDoItems", function (data) {
            $("#result").html(data);
            console.log(data);
            var list = $("#todolist");
            for (var i = 0; i < data.length; i++){

                var myDate = new Date(Date.parse(data[i].Due));

                var dateTime = myDate.getMonth() + "/" + myDate.getDay() + "/" + myDate.getFullYear();


                var panelContainer = document.createElement("div");
                panelContainer.classList.add("panel");
                panelContainer.classList.add("panel-info");

                var panelHeading = document.createElement("div");
                panelHeading.classList.add("panel-heading");

                var panelTitle = document.createElement("h3");
                panelTitle.classList.add("panel-title");
                panelTitle.innerHTML = data[i].Title;

                var panelBody = document.createElement("div");
                panelBody.classList.add("panel-body");
                panelBody.innerHTML += data[i].Description;
                panelBody.innerHTML += "<br />";
                panelBody.innerHTML += "Due: " + dateTime;
                panelBody.innerHTML += "<hr>";
                panelBody.innerHTML += "<div class=\"btn-group\" role=\"group\">" + "<button type=\"button\" class=\"btn btn-default\" onclick=\"CompleteToDo(\'" + data[i].RowKey + "\');\"" + ">Complete</button>" + "<button type=\"button\" class=\"btn btn-default\">Edit</button>" + "<button type=\"button\" class=\"btn btn-default\" onclick=\"Delete(\'" + data[i].RowKey + "\');\"" + ">Delete</button>" + "</div>";

                panelHeading.append(panelTitle);
                panelContainer.append(panelHeading);
                panelContainer.append(panelBody);
                list.append(panelContainer);

            }
        });        
    }

    function CompleteToDo(rowKey) {
        var xhr = new XMLHttpRequest();
        var json = JSON.stringify(rowKey);       

        xhr.open("POST", "/CompleteToDoItem", true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.onreadystatechange = function () {
            if (xhr.status == 200) {
                window.location.reload();
            }
        };
        xhr.send(json);    
    };

    function Delete(rowKey) {
        var xhr = new XMLHttpRequest();
        var json = JSON.stringify(rowKey);
        xhr.open("POST", "/DeleteToDoItem", true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.onreadystatechange = function () {
            if (xhr.status == 200) {
                window.location.reload();
            }
        };
        xhr.send(json); 
    };
</script>